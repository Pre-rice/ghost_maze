<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>鬼迷宫</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>

        <div class="main-container">
            <canvas id="game-canvas" width="600" height="600"></canvas>

            <div class="controls-panel">
                <!-- Game Mode UI -->
                <div id="game-controls">
                    <div class="control-group">
                        <h3>状态</h3>
                        <!-- 右上角操作区：包含帮助和主题切换 -->
                        <div class="header-controls">
                            <!-- Home 按钮 -->
                            <div id="home-btn" class="home-btn" title="回到首页">
                                <svg viewBox="0 0 24 24">
                                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                                </svg>
                            </div>

                            <!-- 帮助按钮 -->
                            <a href="help.html" class="help-btn" title="查看帮助" target="_blank">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
                                </svg>
                            </a>
                            
                            <!-- 原有的主题切换按钮 (保持 ID 不变以兼容 JS) -->
                            <div class="theme-toggle" id="theme-toggle">
                                <div class="theme-toggle-btn" id="theme-toggle-btn">
                                    <svg id="theme-icon" viewBox="0 0 24 24"></svg>
                                </div>
                            </div>
                        </div>
                        <!-- 探索模式状态栏 -->
                        <div id="status-bar-exploration" class="status-bar">
                            <div id="player-health-display" class="label">生命:
                                5</div>
                            <div id="player-keys-display" class="label">钥匙:
                                0</div>
                            <div id="player-steps-display" class="label">步数:
                                0</div>
                            <div id="ghost-proximity-display"
                                class="label">周围鬼数: 0</div>
                        </div>
                        <!-- 死亡循环模式状态栏 -->
                        <div id="status-bar-death-loop" class="status-bar"
                            style="display: none;">
                            <div id="loop-count-display" class="label">循环次数:
                                0</div>
                            <div id="player-keys-display-death-loop"
                                class="label">钥匙: 0</div>
                            <div id="player-stamina-display" class="label">剩余体力:
                                100</div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>控制</h3>
                        <div class="share-buttons-container">
                            <button id="undo-btn" class="secondary">撤回</button>
                            <button id="save-btn" class="secondary">存档</button>
                            <button id="rewind-btn"
                                class="secondary">回溯</button>
                        </div>
                        <div class="toggle-controls-wrapper">
                            <div class="toggle-switch">
                                <span class="label">调试视野</span>
                                <input type="checkbox" id="debug-vision-toggle">
                                <label for="debug-vision-toggle">Toggle</label>
                            </div>
                            <div id="dpad-toggle-container"
                                class="toggle-switch">
                                <span class="label">方向按键</span>
                                <input type="checkbox" id="dpad-toggle" checked>
                                <label for="dpad-toggle">Toggle</label>
                            </div>
                        </div>
                        <button id="generate-map-btn">随机生成新地图</button>
                        <button id="reset-map-btn">重置地图</button>
                    </div>

                    <div class="control-group">
                        <h3>地图选项</h3>
                        <label class="label">模式选择</label>
                        <div class="mode-selector">
                            <button id="mode-exploration-btn"
                                class="mode-btn active">探索模式</button>
                            <button id="mode-death-loop-btn"
                                class="mode-btn">死亡循环</button>
                        </div>
                        <div class="inline-control-group">
                            <label for="map-size-input">地图大小 (8-20):</label>
                            <input type="number" id="map-size-input" value="10"
                                min="8" max="20">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>分享</h3>
                        <div class="share-buttons-container">
                            <button id="copy-share-code-btn">复制分享码</button>
                            <button id="load-share-code-btn">粘贴并加载</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>编辑器</h3>
                        <button id="edit-map-btn">编辑地图</button>
                    </div>
                </div>

                <!-- Editor Mode UI -->
                <div id="editor-controls" style="display: none;">
                    <div class="control-group">
                        <h3>编辑器工具</h3>
                        <div class="editor-toolbar">
                            <button id="tool-wall" class="tool-btn active">墙壁</button>
                            <button id="tool-glass" class="tool-btn">玻璃</button>
                            <button id="tool-door" class="tool-btn">门</button>
                            <button id="tool-oneway" class="tool-btn">单向门</button>
                            <button id="tool-lock" class="tool-btn">数字门</button>
                            <button id="tool-letter" class="tool-btn">字母门</button>
                            <button id="tool-button" class="tool-btn">按钮</button>
                            <button id="tool-ghost" class="tool-btn">鬼</button>
                            <button id="tool-key" class="tool-btn">钥匙</button>
                            <!-- 新增起点工具 (自由模式显示) -->
                            <button id="tool-start" class="tool-btn" style="display:none;">起点</button>
                            <button id="tool-end" class="tool-btn">终点</button>
                            <button id="tool-eraser" class="tool-btn">橡皮擦</button>
                            <!-- 新增地图方格工具 (自由模式显示) -->
                            <button id="tool-grid" class="tool-btn" style="display:none;">地图方格</button>
                        </div>
                    </div>
                    <div class="control-group">
                        <h3>控制</h3>
                        <!-- 新增：编辑器模式切换 -->
                        <label class="label">编辑类型</label>
                        <div class="mode-selector" style="margin-bottom: 10px;">
                            <button id="edit-type-regular-btn" class="mode-btn active">常规模式</button>
                            <button id="edit-type-free-btn" class="mode-btn">自由编辑</button>
                        </div>
                        <button id="play-edited-map-btn">游玩地图</button>
                        <button id="clear-map-btn" class="danger">清空地图</button>
                    </div>
                    <div class="control-group">
                        <h3>地图选项</h3>
                        <label class="label">游戏模式</label>
                        <div class="mode-selector">
                            <button id="editor-mode-exploration-btn"
                                class="mode-btn active">探索模式</button>
                            <button id="editor-mode-death-loop-btn"
                                class="mode-btn">死亡循环</button>
                        </div>
                        <div class="inline-control-group">
                            <label for="editor-map-size-input">地图大小
                                (8-20):</label>
                            <input type="number" id="editor-map-size-input"
                                value="10" min="8" max="20">
                        </div>
                        <div id="initial-health-container"
                            class="inline-control-group">
                            <label for="editor-initial-health">初始生命:</label>
                            <input type="number" id="editor-initial-health"
                                value="5" min="1">
                        </div>
                        <div id="initial-stamina-container"
                            class="inline-control-group" style="display: none;">
                            <label for="editor-initial-stamina">初始体力:</label>
                            <input type="number" id="editor-initial-stamina"
                                value="100" min="1">
                        </div>
                    </div>
                    <div class="control-group">
                        <h3>分享</h3>
                        <div class="share-buttons-container">
                            <button
                                id="editor-copy-share-code-btn">复制分享码</button>
                            <button
                                id="editor-load-share-code-btn">粘贴并加载</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overlays -->
        <div id="death-overlay" class="overlay">
            <div class="overlay-content">
                <h2 id="death-message">你死了</h2>
                <div class="buttons">
                    <button id="revive-btn">复活</button>
                </div>
            </div>
        </div>

        <div id="game-over-overlay" class="overlay">
            <div class="overlay-content">
                <h2>你死了，游戏结束</h2>
                <div class="buttons">
                    <button id="game-over-replay-btn">再次游玩该地图</button>
                    <button id="game-over-new-map-btn">游玩新地图</button>
                </div>
            </div>
        </div>

        <div id="win-overlay" class="overlay">
            <div class="overlay-content">
                <h2>你赢了！</h2>
                <p id="win-stats"></p>
                <div class="buttons">
                    <button id="win-replay-btn">再次游玩该地图</button>
                    <button id="win-new-map-btn">游玩新地图</button>
                </div>
            </div>
        </div>

        <!-- Custom Confirm Overlay -->
        <div id="confirm-overlay" class="overlay">
            <div class="overlay-content">
                <p id="confirm-message">你确定吗？</p>
                <div class="buttons">
                    <button id="confirm-yes-btn" class="danger">确认</button>
                    <button id="confirm-no-btn" class="secondary">取消</button>
                </div>
            </div>
        </div>

        <!-- 清空地图的三选项确认浮窗 -->
        <div id="clear-map-confirm-overlay" class="overlay">
            <div class="overlay-content">
                <p>你希望？</p>
                <div class="buttons">
                    <button id="confirm-clear-entities-btn">清空元件</button>
                    <button id="confirm-reset-grids-btn" class="danger">重置方格</button>
                    <button id="confirm-clear-grids-btn" class="danger">清空方格</button>
                    <button id="confirm-clear-cancel-btn" class="secondary">取消</button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast-notification" class="toast"></div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
        <script src="game.js"></script>
        <div id="dpad-controls" style="display: none;">
            <div id="dpad-up" class="dpad-btn">▲</div>
            <div id="dpad-left" class="dpad-btn">◀</div>
            <div id="dpad-grip"></div> <!-- 新增的拖动把手 -->
            <div id="dpad-right" class="dpad-btn">▶</div>
            <div id="dpad-down" class="dpad-btn">▼</div>
        </div>
    </body>
</html>
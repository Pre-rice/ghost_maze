# 📝《鬼迷宫》地图编辑器——完整规则说明

**前言：** 本文档详述《鬼迷宫》内置**地图编辑器**的界面、功能与交互逻辑。

## （一）编辑器界面布局

编辑器由三个主要部分构成，自上而下排列：

1. **工具栏 (Toolbar)**：包含一系列用于切换当前编辑模式的按钮。
2. **画布 (Canvas)**：占据界面中心，是地图编辑的主要交互区域。
3. **控制按钮 (Control Buttons)**：用于启动游戏或重置地图。

---

## （二）核心画布规则

### 1. 基础网格

* 与游戏地图相同，为 **10 × 10** 的网格。
* 初始状态下，画布上仅有**初始房间的必要外墙**以及**地图边缘的外墙**（这两种墙壁不可编辑），其余所有墙壁均不存在（通路状态）。
* 网格线以**非常浅的灰色**绘制（与游戏界面相同），用于标示格子边界，与玩家添加的深色墙壁形成明显区分。

### 2. 实体与墙壁的视觉呈现

* 大致与鬼迷宫的颜色规则相同
* **初始房间**：3x3 的区域以半透明的浅蓝色背景高亮显示，以明确其特殊性。（游戏界面不显示）

---

## （三）工具栏与编辑模式

工具栏提供四种独立的编辑模式，每次只能激活一种模式。点击按钮可切换模式，当前激活的模式按钮会高亮显示。

### 1. 墙壁编辑模式 (默认)

* **图标/文字**：「编辑墙壁」
* **功能**：此模式下，玩家可以添加或移除墙壁。
* **交互**：
  * **单击**：在墙壁位置上单击，可以切换该墙壁的“有”或“无”状态。（此处即此后的单击都要求按下鼠标和松开鼠标在同一位置）
  * **拖动**：按住并拖动鼠标可以进行“轴向锁定”的连续编辑（详见第四部分）。

### 2. 终点放置模式

* **图标/文字**：「放置终点」
* **功能**：此模式下，玩家可以在地图上放置唯一的终点。
* **交互**：
  * 在任意**非初始房间**的格子上单击，即可将终点放置在该格子。
  * 地图上**最多只能有一个终点**。如果已存在终点，再次点击其他格子会将终点移动到新位置。

### 3. 鬼放置模式

* **图标/文字**：「放置鬼」
* **功能**：此模式下，玩家可以自由放置任意数量的鬼。
* **交互**：
  * 在任意**非初始房间**的格子上单击，会在此处放置一个鬼。
  * 如果在**已经有鬼的格子**上再次单击，则会将该鬼**移除**（切换逻辑）。

### 4. 橡皮擦模式

* **图标/文字**：「橡皮擦」
* **功能**：一个全能的清除工具。
* **交互**：
  * 单击清除，或长按拖动，经过的所有元件会被清除

---

## （四）鼠标交互逻辑 (关键)

### 1. 悬停 (Hover)

* 当**编辑墙壁**或**橡皮擦**模式激活时：
  * 若鼠标指针移动到任意可编辑的墙壁（**初始房间**以及**地图边缘的外墙**是固定结构，不可编辑）位置附近，该墙壁位置会以高亮颜色（如黄色）显示，为玩家提供清晰的视觉反馈。

### 2. 按住并拖动 (Drag) - 轴向锁定逻辑

此逻辑仅在**编辑墙壁**模式下生效，旨在防止误触并实现高效的直线编辑。

* **拖动开始**：当玩家在某个墙壁位置按下鼠标左键时，系统会记录下这第一道墙壁的类型（是**横向的墙**还是**纵向的墙**）。
  * **横向墙壁**：指连接上下两个格子的墙，是一条水平线段。
  * **纵向墙壁**：指连接左右两个格子的墙，是一条垂直线段。
* **轴向锁定**：
  * 如果拖动始于一道**横向墙壁**，则拖动操作将被**锁定在这一行**。无论鼠标指针如何上下移动，都只会影响**当前鼠标指针所在列、被锁定的那一行**的横向墙壁。
  * 如果拖动始于一道**纵向墙壁**，则拖动操作将被**锁定在这一列**。无论鼠标指针如何左右移动，都只会影响**当前鼠标指针所在行、被锁定的那一列**的纵向墙壁。
* **拖动结束**：松开鼠标左键，锁定解除。
* 轴向锁定时取消鼠标悬停的高亮显示

---

## （五）特殊区域：初始房间

左下角的 3x3 初始房间区域在编辑器中是**完全锁定**的，以保证游戏基础逻辑成立。

* **禁止编辑墙壁**：无法添加或移除初始房间内部、外部以及出口的任何墙壁。
* **禁止放置实体**：无法在初始房间的 9 个格子内放置**终点**或**鬼**。
* 会显示并锁定玩家起点的位置

---

## （六）控制按钮功能

### 1. 「游玩地图」按钮（回到游戏界面）（替换原本的“编辑地图”按钮）

点击后，系统会执行一系列校验，全部通过后才能进入游戏。

* **校验流程**：
    1. **检查终点**：必须在地图上放置了终点。若未放置，则弹窗提示：「校验失败！请在地图上放置一个终点。」
    2. **检查连通性**：使用寻路算法（如BFS或DFS）从玩家出生点开始遍历，检查是否能到达地图上的所有 100 个格子。若存在孤岛区域，则弹窗提示：「校验失败！请确保所有格子都是连通的，没有被墙完全隔离的区域。」
* **校验通过**：
  * 重新显示游戏界面。
  * 游戏以当前编辑器中的地图布局（墙壁、终点位置、所有鬼的位置）为蓝本开始新的一局。

### 2. 「清空地图」按钮（替换原本的“重置地图”按钮）

* **功能**：为玩家提供一个快速重置画布的方式。
* **交互**：
  * 点击后，会弹出一个确认框，例如：「你确定要清空所有墙壁、鬼和终点吗？」
  * 玩家确认后，画布将恢复到**初始状态**（仅保留初始房间的必要墙壁，移除所有玩家添加的墙壁、终点和鬼）。
  
### 其余按钮与游戏界面相同（去除血量显示、调试视野开关和“随机生成新地图”按钮）
